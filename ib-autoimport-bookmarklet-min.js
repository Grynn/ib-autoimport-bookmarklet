location.href.substr(0,34)!="https://www.interactivebrokers.com"?alert("This bookmarklet script must be run from the Account Management page on the Interactive Brokers website"):function(e,t,n,r,i,s,o,u){if(!(i=e.jQuery)||n>i.fn.jquery||r(i))s=t.createElement("script"),s.type="text/javascript",s.src="http://ajax.googleapis.com/ajax/libs/jquery/"+n+"/jquery.min.js",s.onload=s.onreadystatechange=function(){!o&&(!(u=this.readyState)||u=="loaded"||u=="complete")&&(r((i=e.jQuery).noConflict(1),o=1),i(s).remove())},t.documentElement.childNodes[0].appendChild(s)}(window,document,"1.8.1",function(e,t){var n=top.frames.content.document,r=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this))};r.prototype={constructor:r,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,r=e.Event("show");this.$element.trigger(r);if(this.isShown||r.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.backdrop(function(){t.$element.parent().length||t.$element.appendTo(n.body),t.$element.show(),t.$element.attr("aria-hidden",!1).focus(),t.enforceFocus(),t.$element.trigger("shown")})},hide:function(t){t&&t.preventDefault();var r=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(n).off("focusin.modal"),this.$element.attr("aria-hidden",!0),this.hideModal()},enforceFocus:function(){var t=this;e(n).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var r=this;this.isShown&&this.options.backdrop?(this.$backdrop=e('<div style="position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000;opacity:0.6;filter:alpha(opacity=60)" />').appendTo(n.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),t()):!this.isShown&&this.$backdrop?this.removeBackdrop():t&&t()}},e.fn.modal=function(t){return this.each(function(){var n=e(this),i=n.data("modal"),s=e.extend({},e.fn.modal.defaults,n.data(),typeof t=="object"&&t);i||n.data("modal",i=new r(this,s)),typeof t=="string"?i[t]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=r;var i="padding:14px 15px 15px;margin-bottom:0;text-align:right;background-color:#f5f5f5;border-top:1px solid #ddd;-webkit-border-radius:0 0 6px 6px;-moz-border-radius:0 0 6px 6px;border-radius:0 0 6px 6px;-webkit-box-shadow:inset 0 1px 0 #fff;-moz-box-shadow:inset 0 1px 0 #fff;box-shadow:inset 0 1px 0 #fff;*zoom:1",s="/Universal/servlet/ReportManagement.Process.ProcessDeliverySettings",o="/Universal/servlet/ReportManagement.Display.Flex.DisplayFlexTradeConfirmsConfigure?cmd=N",u="/Universal/servlet/ReportManagement.Display.Flex.DisplayFlexTradeConfirmsConfigure",a="/Universal/servlet/AccountAccess.Redirector?action=RM_FLEX_TRADE_CONFIRMS",f=e('<div style="position:fixed;top:50%;left:50%;z-index:1050;overflow:auto;width:480px;margin:-150px 0 0 -240px;background-color:#fff;border:1px solid #999;border:1px solid rgba(0,0,0,0.3);*border:1px solid #999;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;-webkit-box-shadow:0 3px 7px rgba(0,0,0,0.3);-moz-box-shadow:0 3px 7px rgba(0,0,0,0.3);box-shadow:0 3px 7px rgba(0,0,0,0.3);-webkit-background-clip:padding-box;-moz-background-clip:padding-box;background-clip:padding-box"><div style="padding:9px 15px;border-bottom:1px solid #eee"><h3>Interactive Brokers Auto Import Setup</h3></div><div style="overflow-y:auto;max-height:400px;padding:10px">Loading...</div><div style="display:none;padding:14px 15px 15px;margin-bottom:0;background-color:#f5f5f5;border-top:1px solid #ddd;-webkit-border-radius:0 0 6px 6px;-moz-border-radius:0 0 6px 6px;border-radius:0 0 6px 6px;-webkit-box-shadow:inset 0 1px 0 #fff;-moz-box-shadow:inset 0 1px 0 #fff;box-shadow:inset 0 1px 0 #fff;*zoom:1"><button type="button" style="width: 80px">OK</button> <button type="button" style="width: 80px">Cancel</button></div></div>').appendTo(n.body).modal().on("hidden",function(){e(this).remove()}).find("button:last").on("click",function(){f.parent().modal("hide")}).end().children().eq(1),l=function(e){f.html("An error has occurred: "+e).next().show().find("button:first").hide()},c=function(t,n,r,i){var s=n(t);s&&s.length?i(s):e.ajax(r).success(function(e){var t=n(e);t&&t.length?i(t):l("Token or report id not found")}).error(l)};e.get(s,{set_flex_webservice_status:"A",whichDiv:"flex",whichForm:"F"},function(t){c(t,function(e){return e.match(/\d{24}/)},{type:"POST",url:s,data:{generate:"generate",ip_address:"",stmt_window:9,whichDiv:"flex",whichForm:"F"}},function(t){var n="cmd=S&queryId=&currentQueryName=&outputFormat=Text&separator=Comma&textOptions=columnHeaders&fromDate=&toDate=&tradeConfirmsIncluded=symbol&tradeConfirmsIncluded=description&tradeConfirmsIncluded=dateTime&tradeConfirmsIncluded=exchange&tradeConfirmsIncluded=buySell&tradeConfirmsIncluded=quantity&tradeConfirmsIncluded=price&tradeConfirmsIncluded=amount&tradeConfirmsIncluded=commission&tcSettings=EXECUTION";f.load(o+' select[name="accounts"]',function(){var r=f.find("select").removeAttr("multiple").before('<p style="line-height:1.1em;margin-bottom:8px"><strong>From which subaccount would you like to import trades?</strong></p>');f.prepend('<p style="line-height:1.1em;margin-bottom:10px">Hey, this nifty script will generate report templates and a web service token for you to give web apps to allow them to automatically import your trades.</div>').next().show().find("button:first").on("click",function(){if(r.length){if(!r.val()){alert("You must select an account to proceed.");return}n+="&accounts="+r.val()}f.html("Setting up reports...").next().hide(),e.get(a,function(i){var s="Auto Import Past"+(r.length?" "+r.val():""),o=function(t){return e(t).find('td:contains("'+s+'")').prev().html()};c(i,o,{type:"POST",url:u,data:n+"&period=Last30CalendarDays&queryName="+encodeURIComponent(s)},function(e){s="Auto Import Today"+(r.length?" "+r.val():""),c(i,o,{type:"POST",url:u,data:n+"&period=Today&queryName="+encodeURIComponent(s)},function(n){f.html('<p>All done! Just copy the values below and paste them into your app.</p><table style="text-align:left"><tr><td><strong>Web Service Token:</strong></td><td style="border: 1px solid #aaa;padding:2px 6px">'+t+'</td></tr><tr><td><strong>Report ID (Past):</strong></td><td style="border: 1px solid #aaa;padding:2px 6px">'+e+'</td></tr><tr><td><strong>Report ID (Today):</strong></td><td style="border: 1px solid #aaa;padding:2px 6px">'+n+"</td></tr></table>").next().show().find("button").first().hide().end().last().html("Close")})})}).error(l)})}).error(l)})}).error(l)});